<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Statistik Dashboard - RB Inside Office</title>
    <link rel="stylesheet" href="../css/styles.css">
    <script src="../js/main.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body >
    <div class="page-container">
        <!-- Page Header -->
        <div class="page-header">
            <!-- Zeile 1: Zurück | Links | Mitte | Rechts -->
            <div class="page-header-row">
                <button class="btn btn-icon" onclick="history.back()">
                    <span class="icon icon--pfeil-links"></span>
                </button>
                <div class="page-header-links">
                    <span class="text-ueberschrift" id="profileName">Max Mustermann</span>
                    <span class="text-klein">Mitarbeiternummer: <span id="employeeId">MA-001</span> • Erstellt am: <span id="createdDate">01.01.2024</span></span>
                </div>
                <div class="page-header-mitte">
                    <span class="text-ueberschrift">Statistik Dashboard</span>
                </div>
                <div class="page-header-rechts">
                </div>
            </div>
            <!-- Lokale Tabs (per Klick navigierbar) -->
            <div class="page-header-tabs" id="dashboardSubTabs">
                <div class="kw-tab active" data-tab="uebersicht">Übersicht</div>
                <div class="kw-tab" data-tab="werben">Werben</div>
                <div class="kw-tab" data-tab="teamleitung">Teamleitung</div>
                <div class="kw-tab" data-tab="quality">Quality</div>
                <div class="kw-tab" data-tab="recruiting">Recruiting</div>
                <div class="kw-tab" data-tab="empfehlung">Empfehlung</div>
            </div>
        </div>

        <!-- Page Content -->
        <div class="page-content">
            <!-- TAB: Übersicht -->
            <div class="kw-tab-content active" id="tab-uebersicht">
                <!-- Werber: Übersicht mit zusammengefasster Tabelle -->
                <div class="abschnitt--card--umrandet" id="uebersichtPlaceholder">
                    <div class="zeile zeile--header">
                        <div class="text-ueberschrift-abschnitt">Übersicht</div>
                    </div>
                    <div class="zeile">
                        <div id="uebersichtStatsTableContainer" style="width: 100%;"></div>
                    </div>
                </div>

                <!-- Kunde/Kampagne/Gebiet: voller Inhalt -->
                <div id="kundeKampagneContent" style="display: none;">
                    <div class="abschnitt--card--umrandet">
                        <div class="zeile zeile--header">
                            <div class="text-ueberschrift-abschnitt">Stats</div>
                        </div>
                        <div class="zeile">
                            <div id="kkStatsTableContainer" style="width: 100%;"></div>
                        </div>
                    </div>

                    <div class="abschnitt--card--umrandet">
                        <div class="zeile zeile--header">
                            <div class="text-ueberschrift-abschnitt">Wochenverlauf</div>
                        </div>
                        <div class="zeile">
                            <div style="height: 280px; width: 100%;">
                                <canvas id="kkChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="abschnitt--card--umrandet">
                        <div class="zeile zeile--header">
                            <div class="text-ueberschrift-abschnitt">Einsätze</div>
                        </div>
                        <div class="zeile">
                            <div id="kkEinsatzTimeline" style="width: 100%;"></div>
                        </div>
                    </div>

                    <div class="abschnitt--card--umrandet">
                        <div class="zeile zeile--header">
                            <div class="text-ueberschrift-abschnitt">Achievements</div>
                        </div>
                        <div class="zeile">
                            <div class="achievement-grid" id="kkAchievementGrid"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- TAB: Werben -->
            <div class="kw-tab-content" id="tab-werben">
                <div class="abschnitt--card--umrandet">
                    <div class="zeile zeile--header">
                        <div class="text-ueberschrift-abschnitt">Stats</div>
                    </div>
                    <div class="zeile">
                        <div id="statsTableContainer" style="width: 100%;"></div>
                    </div>
                </div>

                <div class="abschnitt--card--umrandet">
                    <div class="zeile zeile--header">
                        <div class="text-ueberschrift-abschnitt">Wochenverlauf</div>
                    </div>
                    <div class="zeile">
                        <div style="height: 280px; width: 100%;">
                            <canvas id="werbenChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="abschnitt--card--umrandet">
                    <div class="zeile zeile--header">
                        <div class="text-ueberschrift-abschnitt">Einsätze</div>
                    </div>
                    <div class="zeile">
                        <div id="einsatzTimeline" style="width: 100%;"></div>
                    </div>
                </div>

                <div class="abschnitt--card--umrandet">
                    <div class="zeile zeile--header">
                        <div class="text-ueberschrift-abschnitt">Achievements</div>
                    </div>
                    <div class="zeile">
                        <div class="achievement-grid" id="achievementGrid"></div>
                    </div>
                </div>
            </div>

            <!-- TAB: Teamleitung -->
            <div class="kw-tab-content" id="tab-teamleitung">
                <div class="abschnitt--card--umrandet">
                    <div class="zeile zeile--header">
                        <div class="text-ueberschrift-abschnitt">Stats</div>
                    </div>
                    <div class="zeile">
                        <div id="tlStatsTableContainer" style="width: 100%;"></div>
                    </div>
                </div>

                <div class="abschnitt--card--umrandet">
                    <div class="zeile zeile--header">
                        <div class="text-ueberschrift-abschnitt">Wochenverlauf</div>
                    </div>
                    <div class="zeile">
                        <div style="height: 280px; width: 100%;">
                            <canvas id="teamleitungChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="abschnitt--card--umrandet">
                    <div class="zeile zeile--header">
                        <div class="text-ueberschrift-abschnitt">Einsätze</div>
                    </div>
                    <div class="zeile">
                        <div id="tlEinsatzTimeline" style="width: 100%;"></div>
                    </div>
                </div>

                <div class="abschnitt--card--umrandet">
                    <div class="zeile zeile--header">
                        <div class="text-ueberschrift-abschnitt">Achievements</div>
                    </div>
                    <div class="zeile">
                        <div class="achievement-grid" id="tlAchievementGrid"></div>
                    </div>
                </div>
            </div>

            <!-- TAB: Quality -->
            <div class="kw-tab-content" id="tab-quality">
                <div class="abschnitt--card--umrandet">
                    <div class="zeile zeile--header">
                        <div class="text-ueberschrift-abschnitt">Stats</div>
                    </div>
                    <div class="zeile">
                        <div id="qStatsTableContainer" style="width: 100%;"></div>
                    </div>
                </div>

                <div class="abschnitt--card--umrandet">
                    <div class="zeile zeile--header">
                        <div class="text-ueberschrift-abschnitt">Wochenverlauf</div>
                    </div>
                    <div class="zeile">
                        <div style="height: 280px; width: 100%;">
                            <canvas id="qualityChart"></canvas>
                        </div>
                    </div>
                </div>

                <div class="abschnitt--card--umrandet">
                    <div class="zeile zeile--header">
                        <div class="text-ueberschrift-abschnitt">Einsätze</div>
                    </div>
                    <div class="zeile">
                        <div id="qEinsatzTimeline" style="width: 100%;"></div>
                    </div>
                </div>

                <div class="abschnitt--card--umrandet">
                    <div class="zeile zeile--header">
                        <div class="text-ueberschrift-abschnitt">Achievements</div>
                    </div>
                    <div class="zeile">
                        <div class="achievement-grid" id="qAchievementGrid"></div>
                    </div>
                </div>
            </div>

            <!-- TAB: Recruiting -->
            <div class="kw-tab-content" id="tab-recruiting">
                <div class="abschnitt--card--umrandet">
                    <div class="zeile zeile--header">
                        <div class="text-ueberschrift-abschnitt">Stats</div>
                    </div>
                    <div class="zeile">
                        <div id="rStatsTableContainer" style="width: 100%;"></div>
                    </div>
                </div>

                <div class="abschnitt--card--umrandet">
                    <div class="zeile zeile--header">
                        <div class="text-ueberschrift-abschnitt">Recruiting-Baum</div>
                    </div>
                    <div class="zeile">
                        <div id="rContentContainer" style="width: 100%;"></div>
                    </div>
                </div>

                <div class="abschnitt--card--umrandet">
                    <div class="zeile zeile--header">
                        <div class="text-ueberschrift-abschnitt">Achievements</div>
                    </div>
                    <div class="zeile">
                        <div class="achievement-grid" id="rAchievementGrid"></div>
                    </div>
                </div>
            </div>

            <!-- TAB: Empfehlung -->
            <div class="kw-tab-content" id="tab-empfehlung">
                <div class="abschnitt--card--umrandet">
                    <div class="zeile zeile--header">
                        <div class="text-ueberschrift-abschnitt">Stats</div>
                    </div>
                    <div class="zeile">
                        <div id="eStatsTableContainer" style="width: 100%;"></div>
                    </div>
                </div>

                <div class="abschnitt--card--umrandet">
                    <div class="zeile zeile--header">
                        <div class="text-ueberschrift-abschnitt">Empfehlungs-Baum</div>
                    </div>
                    <div class="zeile">
                        <div id="eContentContainer" style="width: 100%;"></div>
                    </div>
                </div>

                <div class="abschnitt--card--umrandet">
                    <div class="zeile zeile--header">
                        <div class="text-ueberschrift-abschnitt">Achievements</div>
                    </div>
                    <div class="zeile">
                        <div class="achievement-grid" id="eAchievementGrid"></div>
                    </div>
                </div>
            </div>
        </div><!-- /page-content -->
    </div>

    <script>
        // =============================================
        // URL-PARAMETER & INITIALISIERUNG
        // =============================================
        const urlParams = new URLSearchParams(window.location.search);
        const personId = urlParams.get('id');
        const personType = urlParams.get('type');
        const personName = urlParams.get('name');

        if (personName) {
            document.getElementById('profileName').textContent = decodeURIComponent(personName);
        }

        // =============================================
        // SHELL-TOOLBAR AKTIVIEREN
        // =============================================
        if (window.parent !== window) {
            window.parent.postMessage({
                type: 'updateToolbar',
                config: {
                    showToolbar: true,
                    searchPlaceholder: 'Benutzer, Kampagne, Kunde suchen...'
                }
            }, '*');
        }

        // =============================================
        // DEMO-DATEN FÜR SUCHE
        // =============================================
        const searchData = {
            werber: [
                { id: 1, name: 'Max Mustermann', type: 'werber' },
                { id: 2, name: 'Anna Schmidt', type: 'werber' },
                { id: 3, name: 'Thomas Klein', type: 'werber' },
                { id: 4, name: 'Julia Fischer', type: 'werber' },
                { id: 5, name: 'Michael Bauer', type: 'werber' }
            ],
            kunden: [
                { id: 101, name: 'DRK Odenwald', type: 'kunde' },
                { id: 102, name: 'DRK Bergstraße', type: 'kunde' },
                { id: 103, name: 'DRK Darmstadt', type: 'kunde' }
            ],
            kampagnen: [
                { id: 201, name: 'Frühjahr 2025 - DRK Odenwald', type: 'kampagne' },
                { id: 202, name: 'Sommer 2025 - DRK Bergstraße', type: 'kampagne' }
            ],
            gebiete: [
                { id: 301, name: 'Erbach', type: 'gebiet' },
                { id: 302, name: 'Heppenheim', type: 'gebiet' },
                { id: 303, name: 'Darmstadt', type: 'gebiet' },
                { id: 304, name: 'Michelstadt', type: 'gebiet' }
            ]
        };

        const allSearchItems = [...searchData.werber, ...searchData.kunden, ...searchData.kampagnen, ...searchData.gebiete];

        window.addEventListener('message', function(e) {
            if (e.data && e.data.type === 'searchQuery') {
                const query = e.data.query.toLowerCase().trim();
                if (!query) return;

                const results = allSearchItems
                    .filter(item => item.name.toLowerCase().includes(query))
                    .slice(0, 10)
                    .map(item => ({ id: item.id, name: item.name, type: item.type }));

                window.parent.postMessage({
                    type: 'searchResults',
                    query: query,
                    headerText: 'Ergebnisse',
                    results: results
                }, '*');
            }

            if (e.data && e.data.type === 'searchSelect') {
                const selectedItem = allSearchItems.find(item => item.id === e.data.id);
                if (selectedItem) {
                    window.location.href = `dashboard.html?id=${selectedItem.id}&type=${selectedItem.type}&name=${encodeURIComponent(selectedItem.name)}`;
                }
            }
        });

        // =============================================
        // DEMO-DATEN
        // =============================================
        const demoEinsaetze = [
            { von: '06.01.2025', bis: '24.01.2025', kampagne: 'DRK Odenwald', gebiet: 'Erbach', mg: 42, je: 78, eh: 8 },
            { von: '27.01.2025', bis: '07.02.2025', kampagne: 'DRK Bergstraße', gebiet: 'Heppenheim', mg: 31, je: 82, eh: 5 },
            { von: '17.02.2025', bis: '28.02.2025', kampagne: 'DRK Darmstadt', gebiet: 'Darmstadt', mg: 28, je: 71, eh: 4 },
            { von: '10.03.2025', bis: '28.03.2025', kampagne: 'DRK Odenwald', gebiet: 'Michelstadt', mg: 55, je: 85, eh: 12 }
        ];

        const demoTLEinsaetze = [
            { von: '06.01.2025', bis: '24.01.2025', kampagne: 'DRK Odenwald', gebiet: 'Erbach', effizienz: 82 },
            { von: '27.01.2025', bis: '07.02.2025', kampagne: 'DRK Bergstraße', gebiet: 'Heppenheim', effizienz: 76 },
            { von: '17.02.2025', bis: '28.02.2025', kampagne: 'DRK Darmstadt', gebiet: 'Darmstadt', effizienz: 88 },
            { von: '10.03.2025', bis: '28.03.2025', kampagne: 'DRK Odenwald', gebiet: 'Michelstadt', effizienz: 91 }
        ];

        const demoQEinsaetze = [
            { von: '06.01.2025', bis: '24.01.2025', kampagne: 'DRK Odenwald', gebiet: 'Erbach', stornoquote: 4.2 },
            { von: '27.01.2025', bis: '07.02.2025', kampagne: 'DRK Bergstraße', gebiet: 'Heppenheim', stornoquote: 5.8 },
            { von: '17.02.2025', bis: '28.02.2025', kampagne: 'DRK Darmstadt', gebiet: 'Darmstadt', stornoquote: 3.1 },
            { von: '10.03.2025', bis: '28.03.2025', kampagne: 'DRK Odenwald', gebiet: 'Michelstadt', stornoquote: 2.9 }
        ];

        // Achievement-Typen
        const werbenAchievementTypes = [
            { id: 'mg_tag', name: 'Meiste Mitglieder an einem Tag' },
            { id: 'eh_tag', name: 'Meiste EH an einem Tag' },
            { id: 'mg_woche', name: 'Meiste Mitglieder in einer Woche' },
            { id: 'eh_woche', name: 'Meiste EH in einer Woche' },
            { id: 'schrieb_nmg', name: 'Höchster Schrieb Neumitglied' },
            { id: 'beitragsanpassung', name: 'Höchste positive Beitragsanpassung' },
            { id: 'mg_stunde', name: 'Meiste Mitglieder in 1 Stunde' },
            { id: 'eh_durchschnitt_tag', name: 'Höchster Ø EH pro MG an einem Tag' },
            { id: 'serie_stunde', name: 'Längste Stundenserie' },
            { id: 'serie_15min', name: 'Längste 15-Minuten-Serie' },
            { id: 'tage_am_stueck', name: 'Meiste Tage am Stück im Einsatz' },
            { id: 'stornoquote_woche', name: 'Beste Stornoquote in einer Woche' },
            { id: 'eh_stunde', name: 'Meiste EH in 1 Stunde' }
        ];

        const tlAchievementTypes = [
            { id: 'mg_tag', name: 'Meiste Mitglieder an einem Tag' },
            { id: 'eh_tag', name: 'Meiste EH an einem Tag' },
            { id: 'mg_woche', name: 'Meiste Mitglieder in einer Woche' },
            { id: 'eh_woche', name: 'Meiste EH in einer Woche' },
            { id: 'schrieb_nmg', name: 'Höchster Schrieb Neumitglied' },
            { id: 'beitragsanpassung', name: 'Höchste positive Beitragsanpassung' },
            { id: 'mg_stunde', name: 'Meiste Mitglieder in 1 Stunde' },
            { id: 'eh_durchschnitt_tag', name: 'Höchster Ø EH pro MG an einem Tag' },
            { id: 'serie_stunde', name: 'Längste Stundenserie' },
            { id: 'serie_15min', name: 'Längste 15-Minuten-Serie' },
            { id: 'effizienz', name: 'Höchste Effizienz' },
            { id: 'stornoquote_woche', name: 'Beste Stornoquote in einer Woche' },
            { id: 'eh_stunde', name: 'Meiste EH in 1 Stunde' }
        ];

        const qAchievementTypes = [
            { id: 'stornoquote_woche', name: 'Niedrigste Stornoquote pro Woche' },
            { id: 'eh_durchschnitt_woche', name: 'Höchster Tagesdurchschnitt an EH p.P. für eine Woche' },
            { id: 'einschulungen_woche', name: 'Meiste erfolgreiche Einschulungen in einer Woche' },
            { id: 'einschulungen_monat', name: 'Meiste erfolgreiche Einschulungen in einem Monat' },
            { id: 'zahlungsintervall_woche', name: 'Höchster %Satz an jährlichem Zahlungsintervall pro Woche' },
            { id: 'mail_optin_woche', name: 'Höchster %Satz an Mail + Opt In pro Woche' },
            { id: 'tel_optin_woche', name: 'Höchster %Satz an Tel + Opt In pro Woche' }
        ];

        const rAchievementTypes = [
            ...werbenAchievementTypes,
            { id: 'recruitings_monat', name: 'Meiste Recruitings pro Monat' },
            { id: 'recruitings_quartal', name: 'Meiste Recruitings pro Quartal' },
            { id: 'recruitings_serie', name: 'Meiste erfolgreiche Recruitings am Stück' },
            { id: 'recruiting_stufe', name: 'Tiefste Recruiting Stufe' }
        ];

        const eAchievementTypes = [
            ...werbenAchievementTypes,
            { id: 'empfehlungen_monat', name: 'Meiste Empfehlungen pro Monat' },
            { id: 'empfehlungen_quartal', name: 'Meiste Empfehlungen pro Quartal' },
            { id: 'empfehlungen_serie', name: 'Meiste erfolgreiche Empfehlungen am Stück' },
            { id: 'empfehlung_stufe', name: 'Tiefste Empfehlung Stufe' }
        ];

        // Demo-Achievement-Daten
        const demoAchievements = {
            'mg_tag': { score: '12 MG', datum: '15.02.2025', kampagne: 'DRK Odenwald', active: true },
            'eh_tag': { score: '5 EH', datum: '18.02.2025', kampagne: 'DRK Odenwald', active: false },
            'mg_woche': { score: '42 MG', datumVon: '06.01.2025', datumBis: '10.01.2025', kampagne: 'DRK Odenwald', active: true },
            'eh_woche': null,
            'schrieb_nmg': { score: '45,00 €', datum: '22.01.2025', kampagne: 'DRK Bergstraße', active: false },
            'beitragsanpassung': null,
            'mg_stunde': { score: '4 MG', datum: '15.02.2025', kampagne: 'DRK Odenwald', active: true },
            'eh_durchschnitt_tag': null,
            'serie_stunde': null,
            'serie_15min': null,
            'tage_am_stueck': null,
            'stornoquote_woche': null,
            'eh_stunde': null
        };

        const demoTLAchievements = {
            'mg_tag': { score: '48 MG', datum: '15.02.2025', kampagne: 'DRK Odenwald', active: true },
            'eh_tag': { score: '18 EH', datum: '18.02.2025', kampagne: 'DRK Odenwald', active: false },
            'mg_woche': { score: '156 MG', datumVon: '06.01.2025', datumBis: '10.01.2025', kampagne: 'DRK Odenwald', active: true },
            'eh_woche': null,
            'schrieb_nmg': { score: '52,00 €', datum: '22.01.2025', kampagne: 'DRK Bergstraße', active: false },
            'beitragsanpassung': null,
            'mg_stunde': { score: '12 MG', datum: '15.02.2025', kampagne: 'DRK Odenwald', active: true },
            'eh_durchschnitt_tag': null,
            'serie_stunde': null,
            'serie_15min': null,
            'effizienz': { score: '94%', datum: '20.03.2025', kampagne: 'DRK Odenwald', active: true },
            'stornoquote_woche': null,
            'eh_stunde': null
        };

        const demoQAchievements = {
            'stornoquote_woche': { score: '2,1%', datumVon: '10.03.2025', datumBis: '14.03.2025', kampagne: 'DRK Odenwald', active: true },
            'eh_durchschnitt_woche': { score: '1,8 EH', datumVon: '06.01.2025', datumBis: '10.01.2025', kampagne: 'DRK Odenwald', active: false },
            'einschulungen_woche': { score: '4', datumVon: '27.01.2025', datumBis: '31.01.2025', kampagne: 'DRK Bergstraße', active: true },
            'einschulungen_monat': { score: '12', datumVon: '01.02.2025', datumBis: '28.02.2025', kampagne: 'DRK Darmstadt', active: false },
            'zahlungsintervall_woche': { score: '28%', datumVon: '17.02.2025', datumBis: '21.02.2025', kampagne: 'DRK Darmstadt', active: true },
            'mail_optin_woche': { score: '92%', datumVon: '10.03.2025', datumBis: '14.03.2025', kampagne: 'DRK Odenwald', active: false },
            'tel_optin_woche': null
        };

        const demoRAchievements = {
            ...demoAchievements,
            'recruitings_monat': { score: '3', datumVon: '01.02.2025', datumBis: '28.02.2025', kampagne: 'DRK Darmstadt', active: true },
            'recruitings_quartal': { score: '7', datumVon: '01.01.2025', datumBis: '31.03.2025', kampagne: 'DRK Odenwald', active: false },
            'recruitings_serie': { score: '4', datum: '15.03.2025', kampagne: 'DRK Odenwald', active: true },
            'recruiting_stufe': { score: 'Stufe 3', datum: '20.03.2025', kampagne: 'DRK Odenwald', active: false }
        };

        const demoEAchievements = {
            ...demoAchievements,
            'empfehlungen_monat': { score: '5', datumVon: '01.02.2025', datumBis: '28.02.2025', kampagne: 'DRK Darmstadt', active: true },
            'empfehlungen_quartal': { score: '12', datumVon: '01.01.2025', datumBis: '31.03.2025', kampagne: 'DRK Odenwald', active: false },
            'empfehlungen_serie': { score: '6', datum: '18.03.2025', kampagne: 'DRK Odenwald', active: true },
            'empfehlung_stufe': { score: 'Stufe 4', datum: '22.03.2025', kampagne: 'DRK Bergstraße', active: false }
        };

        // Referral-Trees
        const demoRecruitingTree = {
            name: 'Max Mustermann',
            date: null,
            children: [
                {
                    name: 'Anna Schmidt',
                    date: '15.03.2024',
                    mg: 38,
                    eh: 6,
                    children: [
                        { name: 'Peter Müller', date: '01.08.2024' },
                        { name: 'Lisa Weber', date: '15.09.2024' }
                    ]
                },
                {
                    name: 'Thomas Klein',
                    date: '22.05.2024',
                    mg: 52,
                    eh: 9,
                    children: [
                        { name: 'Sarah Braun', date: '10.11.2024' }
                    ]
                },
                {
                    name: 'Julia Fischer',
                    date: '08.07.2024',
                    mg: 28,
                    eh: 4,
                    children: []
                }
            ]
        };

        const demoEmpfehlungTree = {
            name: 'Max Mustermann',
            date: null,
            children: [
                {
                    name: 'Michael Bauer',
                    date: '10.02.2024',
                    mg: 45,
                    eh: 7,
                    children: [
                        { name: 'Nina Hoffmann', date: '20.06.2024' },
                        { name: 'Tim Schneider', date: '05.08.2024' },
                        { name: 'Laura Meyer', date: '18.10.2024' }
                    ]
                },
                {
                    name: 'Sandra Wolf',
                    date: '28.04.2024',
                    mg: 31,
                    eh: 5,
                    children: []
                }
            ]
        };

        // Übersichts-Rows für Werber
        const uebersichtRows = [
            {
                kategorie: 'Netto Mitglieder Werben',
                type: 'netto',
                anzahl: 38,
                jahreseuros: '4.560 €',
                einheiten: 9.5,
                ruecklaufquote: '5,0%',
                ruecklaufquoteMg: '4,2%',
                ruecklaufquoteEur: '7,1%',
                beitrag: '10,00 €',
                alter: 52,
                mailOptin: '85% / 72%',
                telOptin: '78% / 65%',
                zahlungsrhythmus: { m: 45, qt: 25, hj: 15, j: 15 },
                provision: '1.824 €',
                faktor: 6.2,
                children: [
                    { kategorie: 'Neumitglieder', anzahl: 28, jahreseuros: '3.360 €', einheiten: 7.0, ruecklaufquote: '4,2%', ruecklaufquoteMg: '4,2%', ruecklaufquoteEur: '—', beitrag: '10,00 €', alter: 48, mailOptin: '88% / 75%', telOptin: '80% / 68%', zahlungsrhythmus: { m: 40, qt: 30, hj: 15, j: 15 }, provision: '1.344 €', faktor: 6.5 },
                    { kategorie: 'Erhöhungen', anzahl: 10, jahreseuros: '1.200 €', einheiten: 2.5, ruecklaufquote: '7,1%', ruecklaufquoteMg: '—', ruecklaufquoteEur: '7,1%', beitrag: '10,00 €', alter: 62, mailOptin: '78% / 65%', telOptin: '72% / 58%', zahlungsrhythmus: { m: 55, qt: 15, hj: 15, j: 15 }, provision: '480 €', faktor: 5.5 }
                ]
            },
            {
                kategorie: 'Netto Mitglieder Teamleitung',
                type: 'netto',
                anzahl: 156,
                jahreseuros: '18.720 €',
                einheiten: 39.0,
                ruecklaufquote: '4,8%',
                ruecklaufquoteMg: '4,0%',
                ruecklaufquoteEur: '6,5%',
                beitrag: '10,00 €',
                alter: 50,
                mailOptin: '86% / 74%',
                telOptin: '79% / 67%',
                zahlungsrhythmus: { m: 42, qt: 28, hj: 16, j: 14 },
                provision: '7.488 €',
                faktor: 6.4,
                children: [
                    { kategorie: 'Neumitglieder', anzahl: 118, jahreseuros: '14.160 €', einheiten: 29.5, ruecklaufquote: '4,0%', ruecklaufquoteMg: '4,0%', ruecklaufquoteEur: '—', beitrag: '10,00 €', alter: 46, mailOptin: '89% / 77%', telOptin: '81% / 69%', zahlungsrhythmus: { m: 38, qt: 32, hj: 16, j: 14 }, provision: '5.664 €', faktor: 6.7 },
                    { kategorie: 'Erhöhungen', anzahl: 38, jahreseuros: '4.560 €', einheiten: 9.5, ruecklaufquote: '6,5%', ruecklaufquoteMg: '—', ruecklaufquoteEur: '6,5%', beitrag: '10,00 €', alter: 60, mailOptin: '77% / 64%', telOptin: '73% / 59%', zahlungsrhythmus: { m: 52, qt: 18, hj: 16, j: 14 }, provision: '1.824 €', faktor: 5.6 }
                ]
            },
            {
                kategorie: 'Netto Mitglieder Quality',
                type: 'netto',
                anzahl: 42,
                jahreseuros: '5.040 €',
                einheiten: 10.5,
                ruecklaufquote: '2,1%',
                ruecklaufquoteMg: '1,8%',
                ruecklaufquoteEur: '2,9%',
                beitrag: '10,00 €',
                alter: 49,
                mailOptin: '92% / 85%',
                telOptin: '88% / 78%',
                zahlungsrhythmus: { m: 35, qt: 28, hj: 20, j: 17 },
                provision: '2.016 €',
                faktor: 6.8,
                children: [
                    { kategorie: 'Neumitglieder', anzahl: 32, jahreseuros: '3.840 €', einheiten: 8.0, ruecklaufquote: '1,8%', ruecklaufquoteMg: '1,8%', ruecklaufquoteEur: '—', beitrag: '10,00 €', alter: 45, mailOptin: '94% / 88%', telOptin: '90% / 80%', zahlungsrhythmus: { m: 32, qt: 30, hj: 20, j: 18 }, provision: '1.536 €', faktor: 7.0 },
                    { kategorie: 'Erhöhungen', anzahl: 10, jahreseuros: '1.200 €', einheiten: 2.5, ruecklaufquote: '2,9%', ruecklaufquoteMg: '—', ruecklaufquoteEur: '2,9%', beitrag: '10,00 €', alter: 58, mailOptin: '87% / 76%', telOptin: '82% / 70%', zahlungsrhythmus: { m: 42, qt: 22, hj: 20, j: 16 }, provision: '480 €', faktor: 6.2 }
                ]
            },
            {
                kategorie: 'Netto Mitglieder Recruiting',
                type: 'netto',
                anzahl: 85,
                jahreseuros: '10.200 €',
                einheiten: 21.3,
                ruecklaufquote: '4,5%',
                ruecklaufquoteMg: '3,8%',
                ruecklaufquoteEur: '6,2%',
                beitrag: '10,00 €',
                alter: 51,
                mailOptin: '84% / 71%',
                telOptin: '77% / 64%',
                zahlungsrhythmus: { m: 44, qt: 26, hj: 16, j: 14 },
                provision: '4.080 €',
                faktor: 6.3,
                children: [
                    { kategorie: 'Neumitglieder', anzahl: 64, jahreseuros: '7.680 €', einheiten: 16.0, ruecklaufquote: '3,8%', ruecklaufquoteMg: '3,8%', ruecklaufquoteEur: '—', beitrag: '10,00 €', alter: 47, mailOptin: '87% / 74%', telOptin: '80% / 67%', zahlungsrhythmus: { m: 40, qt: 29, hj: 16, j: 15 }, provision: '3.072 €', faktor: 6.6 },
                    { kategorie: 'Erhöhungen', anzahl: 21, jahreseuros: '2.520 €', einheiten: 5.3, ruecklaufquote: '6,2%', ruecklaufquoteMg: '—', ruecklaufquoteEur: '6,2%', beitrag: '10,00 €', alter: 61, mailOptin: '76% / 62%', telOptin: '70% / 56%', zahlungsrhythmus: { m: 54, qt: 18, hj: 16, j: 12 }, provision: '1.008 €', faktor: 5.5 }
                ]
            },
            {
                kategorie: 'Netto Mitglieder Empfehlung',
                type: 'netto',
                anzahl: 62,
                jahreseuros: '7.440 €',
                einheiten: 15.5,
                ruecklaufquote: '3,9%',
                ruecklaufquoteMg: '3,2%',
                ruecklaufquoteEur: '5,4%',
                beitrag: '10,00 €',
                alter: 48,
                mailOptin: '88% / 76%',
                telOptin: '82% / 70%',
                zahlungsrhythmus: { m: 38, qt: 30, hj: 18, j: 14 },
                provision: '2.976 €',
                faktor: 6.6,
                children: [
                    { kategorie: 'Neumitglieder', anzahl: 48, jahreseuros: '5.760 €', einheiten: 12.0, ruecklaufquote: '3,2%', ruecklaufquoteMg: '3,2%', ruecklaufquoteEur: '—', beitrag: '10,00 €', alter: 44, mailOptin: '91% / 79%', telOptin: '85% / 73%', zahlungsrhythmus: { m: 35, qt: 33, hj: 18, j: 14 }, provision: '2.304 €', faktor: 6.9 },
                    { kategorie: 'Erhöhungen', anzahl: 14, jahreseuros: '1.680 €', einheiten: 3.5, ruecklaufquote: '5,4%', ruecklaufquoteMg: '—', ruecklaufquoteEur: '5,4%', beitrag: '10,00 €', alter: 58, mailOptin: '80% / 68%', telOptin: '74% / 62%', zahlungsrhythmus: { m: 48, qt: 22, hj: 18, j: 12 }, provision: '672 €', faktor: 5.8 }
                ]
            }
        ];

        // Kombinierte Achievements für Kunde/Kampagne/Gebiet
        const kkAchievementTypes = [
            ...werbenAchievementTypes,
            { id: 'effizienz', name: 'Höchste Effizienz' },
            { id: 'eh_durchschnitt_woche', name: 'Höchster Tagesdurchschnitt an EH p.P. für eine Woche' },
            { id: 'einschulungen_woche', name: 'Meiste erfolgreiche Einschulungen in einer Woche' },
            { id: 'einschulungen_monat', name: 'Meiste erfolgreiche Einschulungen in einem Monat' },
            { id: 'zahlungsintervall_woche', name: 'Höchster %Satz an jährlichem Zahlungsintervall pro Woche' },
            { id: 'mail_optin_woche', name: 'Höchster %Satz an Mail + Opt In pro Woche' },
            { id: 'tel_optin_woche', name: 'Höchster %Satz an Tel + Opt In pro Woche' }
        ];

        const kkAchievements = {
            ...demoAchievements,
            'stornoquote_woche': { score: '2,1%', datumVon: '10.03.2025', datumBis: '14.03.2025', kampagne: 'DRK Odenwald', active: true },
            'effizienz': { score: '94%', datum: '20.03.2025', kampagne: 'DRK Odenwald', active: true },
            'eh_durchschnitt_woche': { score: '1,8 EH', datumVon: '06.01.2025', datumBis: '10.01.2025', kampagne: 'DRK Odenwald', active: false },
            'einschulungen_woche': { score: '4', datumVon: '27.01.2025', datumBis: '31.01.2025', kampagne: 'DRK Bergstraße', active: true },
            'einschulungen_monat': { score: '12', datumVon: '01.02.2025', datumBis: '28.02.2025', kampagne: 'DRK Darmstadt', active: false },
            'zahlungsintervall_woche': { score: '28%', datumVon: '17.02.2025', datumBis: '21.02.2025', kampagne: 'DRK Darmstadt', active: true },
            'mail_optin_woche': { score: '92%', datumVon: '10.03.2025', datumBis: '14.03.2025', kampagne: 'DRK Odenwald', active: false },
            'tel_optin_woche': null
        };

        // =============================================
        // ANSICHT BASIEREND AUF TYP
        // =============================================
        const isKundeOrKampagne = personType === 'kunde' || personType === 'kampagne' || personType === 'gebiet';

        if (isKundeOrKampagne) {
            // Kunde/Kampagne/Gebiet: Tabs ausblenden, nur Übersicht
            document.getElementById('dashboardSubTabs').style.display = 'none';
            document.getElementById('uebersichtPlaceholder').style.display = 'none';
            document.getElementById('kundeKampagneContent').style.display = 'block';

            document.querySelectorAll('.kw-tab-content:not(#tab-uebersicht)').forEach(el => {
                el.style.display = 'none';
            });

            initStatsTable('kkStatsTableContainer');
            initWochenverlaufChart('kkChart');
            renderEinsatzTimeline('kkEinsatzTimeline', '01.01.2025', '31.03.2025', demoEinsaetze);
            renderAchievementGrid('kkAchievementGrid', kkAchievementTypes, kkAchievements);

        } else {
            // Werber: Alle Tabs anzeigen
            initTabs('.kw-tab', '.kw-tab-content');

            // Übersicht
            initStatsTable('uebersichtStatsTableContainer', { rows: uebersichtRows });

            // Werben
            initStatsTable('statsTableContainer');
            initWochenverlaufChart('werbenChart');
            renderEinsatzTimeline('einsatzTimeline', '01.01.2025', '31.03.2025', demoEinsaetze);
            renderAchievementGrid('achievementGrid', werbenAchievementTypes, demoAchievements);

            // Teamleitung
            initStatsTable('tlStatsTableContainer');
            initWochenverlaufChart('teamleitungChart');
            renderEinsatzTimeline('tlEinsatzTimeline', '01.01.2025', '31.03.2025', demoTLEinsaetze, {
                stats: [{ key: 'effizienz', label: 'Effizienz', suffix: '%' }]
            });
            renderAchievementGrid('tlAchievementGrid', tlAchievementTypes, demoTLAchievements);

            // Quality
            initStatsTable('qStatsTableContainer');
            initWochenverlaufChart('qualityChart');
            renderEinsatzTimeline('qEinsatzTimeline', '01.01.2025', '31.03.2025', demoQEinsaetze, {
                stats: [{ key: 'stornoquote', label: 'Stornoquote', suffix: '%' }]
            });
            renderAchievementGrid('qAchievementGrid', qAchievementTypes, demoQAchievements);

            // Recruiting
            initStatsTable('rStatsTableContainer');
            renderReferralTree('rContentContainer', demoRecruitingTree);
            renderAchievementGrid('rAchievementGrid', rAchievementTypes, demoRAchievements);

            // Empfehlung
            initStatsTable('eStatsTableContainer');
            renderReferralTree('eContentContainer', demoEmpfehlungTree);
            renderAchievementGrid('eAchievementGrid', eAchievementTypes, demoEAchievements);
        }
    </script>
</body>
</html>
