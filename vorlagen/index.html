<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vorlagen - RB Inside Office</title>
    <link rel="stylesheet" href="../css/styles.css">
    <script src="../js/main.js"></script>
</head>
<body >
    <div class="page-container">
        <!-- Page Header -->
        <div class="page-header">
            <div class="page-header-row">
                <div class="page-header-links">
                    <span class="text-ueberschrift">Vorlagen</span>
                </div>
                <div class="page-header-mitte">
                    <span class="text-ueberschrift" id="sectionTitle">Preisvorlagen</span>
                </div>
                <div class="page-header-rechts"></div>
            </div>
            <!-- Shell-Tab: Preisvorlagen (1 Sub-Tab) -->
            <div class="page-header-tabs" id="preisvorlagenSubTabs">
                <div class="kw-tab active" data-tab="preisvorlagen">Formular-Preisvorlagen</div>
            </div>
            <!-- Shell-Tab: E-Mail (4 Sub-Tabs) -->
            <div class="page-header-tabs" id="emailSubTabs" style="display: none;">
                <div class="kw-tab active" data-tab="email-automatisch">Automatisch</div>
                <div class="kw-tab" data-tab="email-manuell">Manuell</div>
                <div class="kw-tab" data-tab="email-newsletter">Newsletter</div>
                <div class="kw-tab" data-tab="email-individuell" id="individualTab">Individuell</div>
            </div>
        </div>

        <!-- Page Content -->
        <div class="page-content">
            <!-- ============================================== -->
            <!-- PREISVORLAGEN CONTENT -->
            <!-- ============================================== -->
            <div class="kw-tab-content active" id="tab-preisvorlagen">
                <div class="vorlage-grid">
                    <!-- Standard Preisvorlage -->
                    <div class="vorlage-card">
                        <div class="vorlage-card-header">
                            <div class="vorlage-card-icon standard">
                                <span class="icon icon--check-kreis"></span>
                            </div>
                            <span class="vorlage-badge default">Standard</span>
                        </div>
                        <h3 class="vorlage-card-title">DRK Standard</h3>
                        <p class="vorlage-card-desc">Standard-Preisvorlage für alle Formulare</p>
                        <div class="vorlage-card-prices">
                            <div class="price-item"><span class="price-label">Klein</span><span class="price-value">5€</span><span class="price-sub">pro Monat</span></div>
                            <div class="price-item"><span class="price-label">Mittel</span><span class="price-value">10€</span><span class="price-sub">pro Monat</span></div>
                            <div class="price-item"><span class="price-label">Groß</span><span class="price-value">20€</span><span class="price-sub">pro Monat</span></div>
                        </div>
                        <div class="vorlage-card-actions">
                            <button class="btn btn-secondary btn-sm" onclick="editPreisvorlage('standard')">Bearbeiten</button>
                            <button class="btn btn-secondary btn-sm" disabled>Löschen</button>
                        </div>
                    </div>

                    <!-- Premium Preisvorlage -->
                    <div class="vorlage-card">
                        <div class="vorlage-card-header">
                            <div class="vorlage-card-icon premium">
                                <span class="icon icon--stern"></span>
                            </div>
                            <span class="vorlage-badge premium">Premium</span>
                        </div>
                        <h3 class="vorlage-card-title">Premium Beiträge</h3>
                        <p class="vorlage-card-desc">Höhere Beiträge für engagierte Förderer</p>
                        <div class="vorlage-card-prices">
                            <div class="price-item"><span class="price-label">Basis</span><span class="price-value">15€</span><span class="price-sub">pro Monat</span></div>
                            <div class="price-item"><span class="price-label">Plus</span><span class="price-value">25€</span><span class="price-sub">pro Monat</span></div>
                            <div class="price-item"><span class="price-label">Premium</span><span class="price-value">50€</span><span class="price-sub">pro Monat</span></div>
                        </div>
                        <div class="vorlage-card-actions">
                            <button class="btn btn-secondary btn-sm" onclick="editPreisvorlage('premium')">Bearbeiten</button>
                            <button class="btn btn-secondary btn-sm" onclick="deletePreisvorlage('premium')">Löschen</button>
                        </div>
                    </div>

                    <!-- Create New Preisvorlage Card -->
                    <div class="vorlage-card vorlage-card--new" onclick="openNewPreisvorlageModal()">
                        <div class="vorlage-card-new-content">
                            <span class="icon icon--plus"></span>
                            <span>Neue Preisvorlage erstellen</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ============================================== -->
            <!-- EMAIL CONTENT -->
            <!-- ============================================== -->
            <!-- Automatische Vorlagen -->
            <div class="kw-tab-content" id="tab-email-automatisch">
                <div class="vorlage-grid">
                    <!-- Willkommensmail -->
                    <div class="vorlage-card">
                        <div class="vorlage-card-header">
                            <div class="vorlage-card-icon standard">
                                <span class="icon icon--email"></span>
                            </div>
                            <span class="vorlage-badge default">Automatisch</span>
                        </div>
                        <h3 class="vorlage-card-title">Willkommensmail</h3>
                        <p class="vorlage-card-desc">Begrüßung neuer Fördermitglieder nach NMG-Formular</p>
                        <div class="vorlage-card-actions">
                            <button class="btn btn-secondary btn-sm" onclick="editTemplate('willkommen')">Bearbeiten</button>
                            <button class="btn btn-secondary btn-sm" onclick="previewTemplate('willkommen')">Vorschau</button>
                        </div>
                    </div>

                    <!-- Erhöhungsmail -->
                    <div class="vorlage-card">
                        <div class="vorlage-card-header">
                            <div class="vorlage-card-icon standard">
                                <span class="icon icon--statistik"></span>
                            </div>
                            <span class="vorlage-badge default">Automatisch</span>
                        </div>
                        <h3 class="vorlage-card-title">Erhöhungsmail</h3>
                        <p class="vorlage-card-desc">Bestätigung bei Beitragsanpassung nach ERH-Formular</p>
                        <div class="vorlage-card-actions">
                            <button class="btn btn-secondary btn-sm" onclick="editTemplate('erhoehung')">Bearbeiten</button>
                            <button class="btn btn-secondary btn-sm" onclick="previewTemplate('erhoehung')">Vorschau</button>
                        </div>
                    </div>

                    <!-- IBAN-Nachtragen -->
                    <div class="vorlage-card">
                        <div class="vorlage-card-header">
                            <div class="vorlage-card-icon standard">
                                <span class="icon icon--kreditkarte"></span>
                            </div>
                            <span class="vorlage-badge default">Automatisch</span>
                        </div>
                        <h3 class="vorlage-card-title">IBAN-Nachtragen</h3>
                        <p class="vorlage-card-desc">Link zum Nachtragen der Bankverbindung</p>
                        <div class="vorlage-card-actions">
                            <button class="btn btn-secondary btn-sm" onclick="editTemplate('iban')">Bearbeiten</button>
                            <button class="btn btn-secondary btn-sm" onclick="previewTemplate('iban')">Vorschau</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Manuelle Vorlagen -->
            <div class="kw-tab-content" id="tab-email-manuell">
                <div class="vorlage-grid">
                    <!-- Storno-Bestätigung -->
                    <div class="vorlage-card">
                        <div class="vorlage-card-header">
                            <div class="vorlage-card-icon premium">
                                <span class="icon icon--bearbeiten"></span>
                            </div>
                            <span class="vorlage-badge premium">Manuell</span>
                        </div>
                        <h3 class="vorlage-card-title">Storno-Bestätigung</h3>
                        <p class="vorlage-card-desc">Bestätigung der Kündigung mit Einmalspende-Anfrage</p>
                        <div class="vorlage-card-actions">
                            <button class="btn btn-secondary btn-sm" onclick="editTemplate('storno')">Bearbeiten</button>
                            <button class="btn btn-primary btn-sm" onclick="sendManual('storno')">Versenden</button>
                        </div>
                    </div>

                    <!-- Erneut senden -->
                    <div class="vorlage-card">
                        <div class="vorlage-card-header">
                            <div class="vorlage-card-icon premium">
                                <span class="icon icon--aktualisieren"></span>
                            </div>
                            <span class="vorlage-badge premium">Manuell</span>
                        </div>
                        <h3 class="vorlage-card-title">Erneut versenden</h3>
                        <p class="vorlage-card-desc">Automatische E-Mail erneut an ein Mitglied senden</p>
                        <div class="vorlage-card-actions">
                            <button class="btn btn-primary btn-sm" onclick="openResendModal()">Mitglied auswählen</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Newsletter -->
            <div class="kw-tab-content" id="tab-email-newsletter">
                <div class="vorlage-grid">
                    <!-- Newsletter Standard -->
                    <div class="vorlage-card">
                        <div class="vorlage-card-header">
                            <div class="vorlage-card-icon standard">
                                <span class="icon icon--zeitung"></span>
                            </div>
                            <span class="vorlage-badge default">Aktiv</span>
                        </div>
                        <h3 class="vorlage-card-title">Newsletter - Standard</h3>
                        <p class="vorlage-card-desc">Allgemeiner Newsletter für alle Fördermitglieder</p>
                        <div class="vorlage-card-actions">
                            <button class="btn btn-secondary btn-sm" onclick="editTemplate('newsletter1')">Bearbeiten</button>
                            <button class="btn btn-primary btn-sm" onclick="sendNewsletter('newsletter1')">Newsletter senden</button>
                        </div>
                    </div>

                    <!-- Newsletter Saisonal -->
                    <div class="vorlage-card">
                        <div class="vorlage-card-header">
                            <div class="vorlage-card-icon premium">
                                <span class="icon icon--zeitung"></span>
                            </div>
                            <span class="vorlage-badge premium">Entwurf</span>
                        </div>
                        <h3 class="vorlage-card-title">Newsletter - Saisonal</h3>
                        <p class="vorlage-card-desc">Saisonale Grüße (Weihnachten, Ostern, etc.)</p>
                        <div class="vorlage-card-actions">
                            <button class="btn btn-secondary btn-sm" onclick="editTemplate('newsletter2')">Bearbeiten</button>
                            <button class="btn btn-secondary btn-sm" onclick="previewTemplate('newsletter2')">Vorschau</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Individuelle Vorlagen -->
            <div class="kw-tab-content" id="tab-email-individuell">
                <!-- Lock Message for lower levels -->
                <div class="locked-section" id="lockedMessage">
                    <div class="locked-icon">
                        <span class="icon icon--schloss"></span>
                    </div>
                    <h3>Individuelle Vorlagen</h3>
                    <p>Ab Stufe III (JMM) freigeschaltet</p>
                </div>

                <!-- Unlocked Content -->
                <div class="unlocked-section" id="unlockedContent" style="display: none;">
                    <div class="vorlage-grid">
                        <!-- Persönlicher Dank -->
                        <div class="vorlage-card">
                            <div class="vorlage-card-header">
                                <div class="vorlage-card-icon individual">
                                    <span class="icon icon--herz"></span>
                                </div>
                                <span class="vorlage-badge individual">Individuell</span>
                            </div>
                            <h3 class="vorlage-card-title">Persönlicher Dank</h3>
                            <p class="vorlage-card-desc">Persönliche Danksagung an besondere Mitglieder</p>
                            <div class="vorlage-card-actions">
                                <button class="btn btn-secondary btn-sm" onclick="editIndividualTemplate('personal-thanks')">Bearbeiten</button>
                                <button class="btn btn-primary btn-sm" onclick="useIndividualTemplate('personal-thanks')">Verwenden</button>
                            </div>
                        </div>

                        <!-- Create New -->
                        <div class="vorlage-card vorlage-card--new" onclick="openCreateIndividualModal()">
                            <div class="vorlage-card-new-content">
                                <span class="icon icon--plus"></span>
                                <span>Neue Vorlage erstellen</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Preisvorlage Modal -->
    <div class="modal modal-m" id="preisvorlageModal">
        <div class="page-container page-container--modal">
            <!-- Modal Header -->
            <div class="page-header">
                <div class="page-header-row">
                    <div class="page-header-links">
                        <span class="text-ueberschrift" id="preisvorlageModalTitle">Preisvorlage bearbeiten</span>
                    </div>
                    <div class="page-header-mitte"></div>
                    <div class="page-header-rechts">
                        <button class="btn btn-icon" onclick="closeModalById('preisvorlageModal')">
                            <span class="icon icon--schliessen"></span>
                        </button>
                    </div>
                </div>
                <div class="page-header-tabs">
                    <div class="kw-tab active" data-tab="modal-daten">Daten</div>
                </div>
            </div>
            <!-- Modal Body -->
            <div class="page-content page-content--modal">
                <!-- Allgemein -->
                <div class="unterabschnitt--card">
                    <div class="zeile">
                        <div class="text-ueberschrift-unterabschnitt">Allgemein</div>
                    </div>
                    <div class="zeile">
                        <div class="eingabefeld-gruppe">
                            <label class="eingabefeld-beschriftung-oben">Name der Vorlage</label>
                            <input type="text" class="eingabefeld" id="preisvorlageName" maxlength="20" placeholder="z.B. DRK Standard">
                            <span class="eingabefeld-beschriftung-unten">Max. 20 Zeichen</span>
                        </div>
                        <div class="eingabefeld-gruppe eingabefeld-gruppe--flex-0-5">
                            <label class="eingabefeld-beschriftung-oben">Symbol</label>
                            <div class="symbol-picker" id="symbolPicker">
                                <button type="button" class="symbol-option active" data-symbol="checkmark" title="Häkchen">
                                    <span class="icon icon--check-kreis"></span>
                                </button>
                                <button type="button" class="symbol-option" data-symbol="star" title="Stern">
                                    <span class="icon icon--stern"></span>
                                </button>
                                <button type="button" class="symbol-option" data-symbol="euro" title="Euro">
                                    <span class="icon icon--euro"></span>
                                </button>
                                <button type="button" class="symbol-option" data-symbol="heart" title="Herz">
                                    <span class="icon icon--herz"></span>
                                </button>
                                <button type="button" class="symbol-option" data-symbol="gift" title="Geschenk">
                                    <span class="icon icon--geschenk"></span>
                                </button>
                            </div>
                            <span class="eingabefeld-beschriftung-unten"></span>
                        </div>
                    </div>
                    <div class="zeile">
                        <div class="eingabefeld-gruppe">
                            <label class="eingabefeld-beschriftung-oben">Beschreibung</label>
                            <input type="text" class="eingabefeld" id="preisvorlageDesc" maxlength="42" placeholder="z.B. Standard-Preisvorlage für alle Formulare">
                            <span class="eingabefeld-beschriftung-unten">Max. 42 Zeichen</span>
                        </div>
                    </div>
                </div>

                <!-- Beiträge -->
                <div class="unterabschnitt--card">
                    <div class="zeile">
                        <div class="text-ueberschrift-unterabschnitt">Beiträge konfigurieren</div>
                    </div>
                    <div class="zeile">
                        <div class="eingabefeld-gruppe">
                            <label class="eingabefeld-beschriftung-oben">Beschriftung 1</label>
                            <input type="text" class="eingabefeld" id="beitrag1Label" maxlength="20" placeholder="z.B. Klein">
                            <span class="eingabefeld-beschriftung-unten"></span>
                        </div>
                        <div class="eingabefeld-gruppe">
                            <label class="eingabefeld-beschriftung-oben">Beschriftung 2</label>
                            <input type="text" class="eingabefeld" id="beitrag2Label" maxlength="20" placeholder="z.B. Mittel">
                            <span class="eingabefeld-beschriftung-unten"></span>
                        </div>
                        <div class="eingabefeld-gruppe">
                            <label class="eingabefeld-beschriftung-oben">Beschriftung 3</label>
                            <input type="text" class="eingabefeld" id="beitrag3Label" maxlength="20" placeholder="z.B. Groß">
                            <span class="eingabefeld-beschriftung-unten"></span>
                        </div>
                    </div>
                    <div class="zeile">
                        <div class="eingabefeld-gruppe">
                            <label class="eingabefeld-beschriftung-oben">Betrag 1 (€)</label>
                            <input type="number" class="eingabefeld" id="beitrag1Value" min="1" placeholder="5">
                            <span class="eingabefeld-beschriftung-unten"></span>
                        </div>
                        <div class="eingabefeld-gruppe">
                            <label class="eingabefeld-beschriftung-oben">Betrag 2 (€)</label>
                            <input type="number" class="eingabefeld" id="beitrag2Value" min="1" placeholder="10">
                            <span class="eingabefeld-beschriftung-unten"></span>
                        </div>
                        <div class="eingabefeld-gruppe">
                            <label class="eingabefeld-beschriftung-oben">Betrag 3 (€)</label>
                            <input type="number" class="eingabefeld" id="beitrag3Value" min="1" placeholder="20">
                            <span class="eingabefeld-beschriftung-unten"></span>
                        </div>
                    </div>
                    <div class="zeile">
                        <div class="eingabefeld-gruppe">
                            <label class="eingabefeld-beschriftung-oben">Untertitel 1</label>
                            <input type="text" class="eingabefeld" id="beitrag1Sub" maxlength="30" placeholder="z.B. pro Monat">
                            <span class="eingabefeld-beschriftung-unten"></span>
                        </div>
                        <div class="eingabefeld-gruppe">
                            <label class="eingabefeld-beschriftung-oben">Untertitel 2</label>
                            <input type="text" class="eingabefeld" id="beitrag2Sub" maxlength="30" placeholder="z.B. pro Monat">
                            <span class="eingabefeld-beschriftung-unten"></span>
                        </div>
                        <div class="eingabefeld-gruppe">
                            <label class="eingabefeld-beschriftung-oben">Untertitel 3</label>
                            <input type="text" class="eingabefeld" id="beitrag3Sub" maxlength="30" placeholder="z.B. pro Monat">
                            <span class="eingabefeld-beschriftung-unten"></span>
                        </div>
                    </div>
                </div>
            </div>
            <!-- Modal Footer -->
            <div class="page-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModalById('preisvorlageModal')">Abbrechen</button>
                <button type="button" class="btn btn-primary" onclick="savePreisvorlage()">Speichern</button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // INITIALISIERUNG
        // ============================================
        let currentSection = 'preisvorlagen';

        // Sub-Tabs für beide Sektionen
        initTabs('#preisvorlagenSubTabs .kw-tab', '.kw-tab-content');
        initTabs('#emailSubTabs .kw-tab', '.kw-tab-content');

        initSymbolPicker();

        // ============================================
        // SECTION SWITCH (Shell-Navigation)
        // ============================================
        const sectionConfig = {
            preisvorlagen: {
                containerId: 'preisvorlagenSubTabs',
                firstContentId: 'tab-preisvorlagen',
                title: 'Preisvorlagen'
            },
            email: {
                containerId: 'emailSubTabs',
                firstContentId: 'tab-email-automatisch',
                title: 'E-Mail Vorlagen'
            }
        };

        function switchSection(section) {
            currentSection = section;
            selectShellTab(section, {
                subTabs: sectionConfig,
                contentSelector: '.page-content > .kw-tab-content',
                titleSelector: '#sectionTitle'
            });
        }

        // ============================================
        // PREISVORLAGEN FUNKTIONEN
        // ============================================
        function openNewPreisvorlageModal() {
            document.getElementById('preisvorlageModalTitle').textContent = 'Neue Preisvorlage erstellen';
            document.getElementById('preisvorlageName').value = '';
            document.getElementById('preisvorlageDesc').value = '';
            document.getElementById('beitrag1Label').value = '';
            document.getElementById('beitrag2Label').value = '';
            document.getElementById('beitrag3Label').value = '';
            document.getElementById('beitrag1Value').value = '';
            document.getElementById('beitrag2Value').value = '';
            document.getElementById('beitrag3Value').value = '';
            document.getElementById('beitrag1Sub').value = '';
            document.getElementById('beitrag2Sub').value = '';
            document.getElementById('beitrag3Sub').value = '';
            openModalById('preisvorlageModal');
        }

        function editPreisvorlage(id) {
            document.getElementById('preisvorlageModalTitle').textContent = 'Preisvorlage bearbeiten';
            if (id === 'standard') {
                document.getElementById('preisvorlageName').value = 'DRK Standard';
                document.getElementById('preisvorlageDesc').value = 'Standard-Preisvorlage für alle Formulare';
                document.getElementById('beitrag1Label').value = 'Klein';
                document.getElementById('beitrag2Label').value = 'Mittel';
                document.getElementById('beitrag3Label').value = 'Groß';
                document.getElementById('beitrag1Value').value = '5';
                document.getElementById('beitrag2Value').value = '10';
                document.getElementById('beitrag3Value').value = '20';
                document.getElementById('beitrag1Sub').value = 'pro Monat';
                document.getElementById('beitrag2Sub').value = 'pro Monat';
                document.getElementById('beitrag3Sub').value = 'pro Monat';
            } else if (id === 'premium') {
                document.getElementById('preisvorlageName').value = 'Premium Beiträge';
                document.getElementById('preisvorlageDesc').value = 'Höhere Beiträge für engagierte Förderer';
                document.getElementById('beitrag1Label').value = 'Basis';
                document.getElementById('beitrag2Label').value = 'Plus';
                document.getElementById('beitrag3Label').value = 'Premium';
                document.getElementById('beitrag1Value').value = '15';
                document.getElementById('beitrag2Value').value = '25';
                document.getElementById('beitrag3Value').value = '50';
                document.getElementById('beitrag1Sub').value = 'pro Monat';
                document.getElementById('beitrag2Sub').value = 'pro Monat';
                document.getElementById('beitrag3Sub').value = 'pro Monat';
            }
            openModalById('preisvorlageModal');
        }

        async function deletePreisvorlage(id) {
            const confirmed = await showConfirm('Löschen', 'Möchten Sie diese Preisvorlage wirklich löschen?', 'warning');
            if (confirmed) {
                showToast('Preisvorlage gelöscht', 'success');
            }
        }

        async function savePreisvorlage() {
            closeModalById('preisvorlageModal');
            showToast('Preisvorlage gespeichert', 'success');
        }

        // ============================================
        // EMAIL FUNKTIONEN
        // ============================================
        async function editTemplate(templateId) {
            showToast('Vorlage bearbeiten - Coming soon', 'info');
        }

        async function previewTemplate(templateId) {
            showToast('Vorschau - Coming soon', 'info');
        }

        async function sendManual(templateId) {
            showToast('Manuelle E-Mail - Coming soon', 'info');
        }

        async function sendNewsletter(templateId) {
            const confirmed = await showConfirm('Newsletter versenden', 'Newsletter an alle Fördermitglieder senden?', 'question');
            if (confirmed) {
                showToast('Newsletter wird versendet...', 'success');
            }
        }

        async function openResendModal() {
            showToast('Erneut senden - Coming soon', 'info');
        }

        async function openCreateIndividualModal() {
            showToast('Neue Vorlage erstellen - Coming soon', 'info');
        }

        async function editIndividualTemplate(templateId) {
            showToast('Vorlage bearbeiten - Coming soon', 'info');
        }

        async function useIndividualTemplate(templateId) {
            showToast('Vorlage öffnen...', 'info');
        }

        // ============================================
        // STUFEN-CHECK FÜR INDIVIDUELLE VORLAGEN
        // ============================================
        function checkIndividualAccess() {
            const userStage = 3; // Demo: Stage III
            const hasAccess = userStage >= 3;

            const lockedMessage = document.getElementById('lockedMessage');
            const unlockedContent = document.getElementById('unlockedContent');
            const individualTab = document.getElementById('individualTab');

            if (hasAccess) {
                lockedMessage.style.display = 'none';
                unlockedContent.style.display = 'block';
                if (individualTab) individualTab.classList.remove('locked');
            } else {
                lockedMessage.style.display = 'block';
                unlockedContent.style.display = 'none';
                if (individualTab) individualTab.classList.add('locked');
            }
        }

        checkIndividualAccess();

        // ============================================
        // SHELL INTEGRATION
        // ============================================
        window.addEventListener('message', function(e) {
            if (e.data && e.data.type === 'navFilter') {
                switchSection(e.data.value);
            }
        });
    </script>
</body>
</html>
